{% extends "base.html" %}

{% block title %}Find Restaurants - QuantumDecider{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body p-5">
                <h2 class="card-title text-center mb-4 text-danger"><i class="fas fa-map-marker-alt me-2"></i>Choose Your Location</h2>

                <form action="/location" method="post" class="needs-validation" novalidate>
                    <!-- Map container -->
                    <div class="mb-4">
                        <label for="map" class="form-label">Click to Place a Marker</label>
                        <div id="map" style="height: 400px;" class="rounded border"></div>
                        <input type="hidden" id="latitude" name="latitude" required>
                        <input type="hidden" id="longitude" name="longitude" required>
                        <div class="invalid-feedback">Please select a location on the map.</div>
                    </div>

                    <!-- Radius dropdown -->
                    <div class="mb-4">
                        <label for="radius" class="form-label">Search Radius (miles)</label>
                        <select class="form-select" id="radius" name="radius" required>
                            <option value="" disabled selected>Select a radius</option>
                            <option value="5">5 miles</option>
                            <option value="10">10 miles</option>
                            <option value="20">20 miles</option>
                            <option value="50">50 miles</option>
                            <option value="100">100 miles</option>
                            <option value="1000">1000 miles</option>
                        </select>
                        <div class="invalid-feedback">Please select a search radius.</div>
                    </div>

                    <div class="mb-4">
                        <label for="user_prompt" class="form-label">Preferences (Optional)</label>
                        <textarea class="form-control" id="user_prompt" name="user_prompt" rows="3" placeholder="Enter any cuisine preferences (optional)."></textarea>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-danger btn-lg w-100">
                            <i class="fas fa-search-location me-2"></i>Find Restaurants
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Leaflet.js CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Initialize map
const map = L.map('map').setView([37.0902, -95.7129], 4); // Default: USA center

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let marker;

// Add marker on click
map.on('click', function (e) {
    if (marker) {
        map.removeLayer(marker);
    }
    marker = L.marker(e.latlng).addTo(map);
    document.getElementById('latitude').value = e.latlng.lat;
    document.getElementById('longitude').value = e.latlng.lng;
});

// Form validation
(function () {
    'use strict'
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})()
</script>
{% endblock %}
